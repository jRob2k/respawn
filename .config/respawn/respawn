#!/usr/bin/env bash

#Setting variables
RESPAWN_DIR=$HOME/.config/respawn
FISH=$(which fish)
BASH=$(which bash)
ZSH=$(which zsh)
SALT=$(which salt-call)

    
#Presenting a platform specific help menu
function help() {
    echo "~~~~ $OSTYPE ~~~~"
    echo "$0 accepts the following commands:"
        echo "---- "
        echo "-h | --help (This help menu!!!)"
        echo "-g | --go (run the Salt high state)"
        echo "-s | --salt <state> (runs one state instead of the entire highstate)"
}

# Finding salt installation and setting variable
SALT=$(which salt-call)
function sc() {
    sudo "$SALT" \
        --config-dir="${RESPAWN_DIR}" \
        $salt_command $state $flag_1 $option_1 \
        pillar="{'user': '$USER', 'home': '$HOME', 'fish': '$FISH', 'bash': '$BASH', 'zim': '$ZIM_HOME', 'zsh': '$ZSH', 'secrets_dir': '$RESPAWN_DIR/secrets'}" 

    # Change default shell back to FISH if it was FISH
    # if [[ $ORIGINALSHELL != $SHELL ]]; then
    #     sudo chsh -s $ORIGINALSHELL $USER
    # fi
}


case "$1" in
    # Display help to user
    "-h" | "--help")
    help
    ;;

    #Salt states
    "-s" | "--salt")
    salt_command="state.apply"
    state=$2
    flag_1=$3
    option_1=$4
    sc
    ;;

    #Salt highstate
    "-g" | "--go")
    salt_command="state.apply"
    state=""
    sc

        if [[ $(echo $SHELL) != $ZSH ]]; then
            $ZSH
        fi
        ;;

    #Launch help
    *)
    help
    ;;
esac

